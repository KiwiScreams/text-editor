<!DOCTYPE html>
<html lang="ge">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Проверка правок — подсветка с подсказкой</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f7fa; padding:30px; }
h1 { text-align:center; margin-bottom:15px;}
textarea { width:100%; min-height:150px; font-size:16px; padding:10px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; resize:vertical; }
button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; background:#007bff; color:white; cursor:pointer; }
button:disabled { background:#aaa; cursor:not-allowed; }
.display-text { white-space:pre-wrap; line-height:1.5; font-size:16px; padding:10px; border-radius:6px; border:1px solid #ccc; background:#fff; }
.tok { padding:2px 4px; border-radius:4px; margin:0 1px; display:inline-block; }
.tok.correct { background:#c8f7c5; } /* исправлено правильно */
.tok.wrong { background:#f7c5c5; }   /* исправлено неправильно */
.tok.missed { background:#fff7c5; }  /* пропущено */
.tok .hint { background:#fff7c5; color:#222; margin-left:4px; padding:1px 4px; border-radius:3px; font-size:14px; }
.score { font-weight:bold; margin-top:10px; }
</style>
</head>
<body>
<h1>Задание — исправь ошибки</h1>
<textarea id="userInput"></textarea>
<button id="checkBtn">Проверить</button>
<div class="score" id="score">Очки: 0</div>
<div class="display-text" id="result"></div>

<script>
// Тексты
const wrongText = `ფეხბურთი სპორტის ყველაზე პოპულარული სახეობაა მსოფლიოში. ეს თამაში XIX საუკუნეში შეიქმნა ინგლისში.
ინგლისელებმა შემოიტანეს ის საქართველოშიც. ფოთისა და ბათუმის მოსახლეობა ხშირად ხედავდნენ თუ როგორ
თამაშობდნენ 'ფუტბოლს' ბრიტანულ გემების მეზღვაურები. სპორტის ეს სახეობა სულ მალე ქართველებმაც შეიყვარეს.
ფეხბურთი ქართულ პრესაში პირველათ 1890 წელს არის ნახსენები.
საქართველოს ზღვის პირა ქალაქების შემდეგ ფეხბურთი თბილისშიც შემოვიდა. ამავე პერიოდში ინგლისურიდან
თამაშის წესები ითარგმნა. 1906 წელს ჩამოყალიბდა ფეხბურთის მოყვარულთა წრე რომელსაც ვარჯიშისათვის სათანადო
გარემო ჭირდებოდა. გადაწყდა რომ საფეხბურთო მოედანისათვის შესაფერისი ადგილი დიდუბის იპოდრომზე გამოეყოთ.
პირველი ოფიციალური შეხვედრა 1911 წელს გაიმართა. ერთი წლის შემდეგ ჩატარდა ქალაქის ჩემპიონატი რომელშიც
გამარჯვება მოიხვეჭა ვაჟთა II გიმნაზიის გუნდმა. 1923 წელს ერთმანეთს უკვე 27 გუნდი ეჯიბრებოდა. 1925 წელს შეიქმნა
საფეხბურთო გუნდი „დინამო“ რის სახელთანაც არის დაკავშირებული ქართული ფეხბურთის არაერთი მნიშვნელოვანი
წარმატება.
1990 წლის 15 თებერვალს დაარსდა საქართველოს ფეხბურთის ფედერაცია რომელმაც იმავე წელს უხელმძღვანელა
საქართველოს პირველ დამოუკიდებელ ჩემპიონატსა და თასის გათამაშებას.`;

const correctText = `ფეხბურთი სპორტის ყველაზე პოპულარული სახეობაა მსოფლიოში. ეს თამაში XIX საუკუნეში შეიქმნა ინგლისში. ინგლისელებმა შემოიტანეს ის საქართველოშიც. ფოთისა და
ბათუმის მოსახლეობა ხშირად ხედავდა, თუ როგორ თამაშობდნენ 'ფუტბოლს' ბრიტანული
გემების მეზღვაურები. სპორტის ეს სახეობა სულ მალე ქართველებმაც შეიყვარეს. ფეხბურთი
ქართულ პრესაში პირველად 1890 წელს არის ნახსენები.
საქართველოს ზღვისპირა ქალაქების შემდეგ ფეხბურთი თბილისშიც შემოვიდა. ამავე
პერიოდში ინგლისურიდან თამაშის წესები ითარგმნა. 1906 წელს ჩამოყალიბდა ფეხბურთის
მოყვარულთა წრე, რომელსაც ვარჯიშისათვის სათანადო გარემო სჭირდებოდა. გადაწყდა, რომ
საფეხბურთო მოედნისათვის შესაფერისი ადგილი დიდუბის იპოდრომზე გამოეყოთ. პირველი
ოფიციალური შეხვედრა 1911 წელს გაიმართა. ერთი წლის შემდეგ ჩატარდა ქალაქის
ჩემპიონატი, რომელშიც გამარჯვება მოიპოვა ვაჟთა II გიმნაზიის გუნდმა. 1923 წელს ერთმანეთს
უკვე 27 გუნდი ეჯიბრებოდა. 1925 წელს შეიქმნა საფეხბურთო გუნდი „დინამო“, რომლის
სახელთანაც არის დაკავშირებული ქართული ფეხბურთის არაერთი მნიშვნელოვანი წარმატება.
1990 წლის 15 თებერვალს დაარსდა საქართველოს ფეხბურთის ფედერაცია, რომელმაც
იმავე წელს უხელმძღვანელა საქართველოს პირველ დამოუკიდებელ ჩემპიონატსა და თასის
გათამაშებას.`;

// Элементы
const tArea = document.getElementById("userInput");
const checkBtn = document.getElementById("checkBtn");
const resultDiv = document.getElementById("result");
const scoreDiv = document.getElementById("score");

tArea.value = wrongText;

// Токенизация (слова и знаки препинания) с поддержкой грузинских букв
function tokenize(text) {
    return text.match(/[\p{Script=Georgian}\w]+|[^\s\p{Script=Georgian}\w]/gu) || [];
}

// Выравнивание токенов (редакционное расстояние)
function align(correct, user) {
    const n = correct.length, m = user.length;
    const dp = Array.from({length:n+1},()=>Array(m+1).fill(0));
    for(let i=0;i<=n;i++) dp[i][0]=i;
    for(let j=0;j<=m;j++) dp[0][j]=j;
    for(let i=1;i<=n;i++){
        for(let j=1;j<=m;j++){
            dp[i][j] = correct[i-1]===user[j-1]?dp[i-1][j-1]:Math.min(dp[i-1][j-1]+1, dp[i-1][j]+1, dp[i][j-1]+1);
        }
    }
    let i=n,j=m;
    const aligned = [];
    while(i>0 || j>0){
        if(i>0 && j>0 && dp[i][j]===dp[i-1][j-1]+ (correct[i-1]===user[j-1]?0:1)){
            aligned.unshift([correct[i-1], user[j-1]]);
            i--; j--;
        } else if(i>0 && dp[i][j]===dp[i-1][j]+1){
            aligned.unshift([correct[i-1], null]);
            i--;
        } else {
            aligned.unshift([null, user[j-1]]);
            j--;
        }
    }
    return aligned;
}

// Проверка текста
checkBtn.addEventListener("click",()=>{
    const userTokens = tokenize(tArea.value);
    const correctTokens = tokenize(correctText);
    const wrongTokens = tokenize(wrongText);

    const alignment = align(correctTokens, userTokens);

    let resultHTML = "";
    let score = 0;

    for(const [corr, user] of alignment){
        if(corr!==null && user===corr){
            if(user!==wrongTokens[wrongTokens.indexOf(corr)]){
                // исправлено правильно
                resultHTML += `<span class="tok correct">${user}</span> `;
                score++;
            } else {
                // не трогал правильный токен
                resultHTML += `${user} `;
            }
        } else if(corr!==null && user!==corr){
            if(user===null){
                // пропущено исправление
                resultHTML += `<span class="tok missed">${corr}</span> `;
                score--;
            } else {
                // исправлено неверно, показываем подсказку
                resultHTML += `<span class="tok wrong">${user}<span class="hint">${corr}</span></span> `;
                score--;
            }
        } else if(corr===null && user!==null){
            // лишний токен
            resultHTML += `<span class="tok wrong">${user}</span> `;
            score--;
        }
    }

    resultDiv.innerHTML = resultHTML.trim();
    scoreDiv.textContent = "Очки: "+score;
    tArea.disabled = true;
    checkBtn.disabled = true;
});
</script>
</body>
</html>
